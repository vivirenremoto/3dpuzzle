<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetris 3D</title>

    
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

    
    <link rel="prefetch" href="static/music.mp3" />
    <link rel="prefetch" href="static/fail.mp3" />
    <link rel="prefetch" href="static/1.png" />
    <link rel="prefetch" href="static/2.png" />
    <link rel="prefetch" href="static/3.png" />
    <link rel="prefetch" href="static/4.png" />
    <link rel="prefetch" href="static/5.png" />
    <link rel="prefetch" href="static/1__.png" />
    <link rel="prefetch" href="static/2__.png" />
    <link rel="prefetch" href="static/3__.png" />
    <link rel="prefetch" href="static/4__.png" />
    <link rel="prefetch" href="static/5__.png" />
    <link rel="prefetch" href="static/bg.gif" />

    
    <meta property="og:image" content="https://vivirenremoto.github.io/tetris3d/static/social.jpg">
    <meta property="og:image:secure_url" content="https://vivirenremoto.github.io/tetris3d/static/social.jpg">
    <meta property="og:image:alt" content="Tetris 3D">
    <meta property="og:image:type" content="image/png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Tetris 3D">
    <meta name="twitter:image" content="https://vivirenremoto.github.io/tetris3d/static/social.jpg">

</head>
<body>

<style>
* {
    font-family: 'VT323', monospace;
    text-transform: uppercase;

    -webkit-touch-callout: none;
    /* iOS Safari */
    -webkit-user-select: none;
    /* Safari */
    -khtml-user-select: none;
    /* Konqueror HTML */
    -moz-user-select: none;
    /* Old versions of Firefox */
    -ms-user-select: none;
    /* Internet Explorer/Edge */
    user-select: none;
    /* Non-prefixed version, currently
                    supported by Chrome, Edge, Opera and Firefox */

    /* evitar elementos seleccionados al clicar */
    -webkit-tap-highlight-color: transparent;
}

body {
    touch-action: pan-x pan-y;
    overflow:hidden;
}

.ui-page{border:0;width:100%;height:100%;min-height:100%;min-width:100%;max-width:100%;max-height:100%;}

body{background:black;height:100%;width:100%;padding:0;margin:0;}
#cover{opacity:0.5;}
.game td{opacity:0.3;}

#cover{background-size:100% auto;background-image:url("static/bg_screen.gif");}

@media screen and (max-width: 500px) {
    #cover{background-size:auto 100%;background-size:100% auto;background-image:url("static/bg.gif");}
    #author{display:none;}
}
</style>

    
<a id="author" href="https://twitter.com/vivirenremoto" target="_blank"
style="font-size:30px;position:fixed;right:10px;top:10px;z-index:2;color:white;text-decoration:none;">by
@vivirenremoto</a>


<div id="intro" style="color:white;text-align:center;font-size:30px;">
    <h1>Tetris 3D</h1>

    In each round you have a maximum of 2 moves<br>to put the piece in their place,<br>if you fail your score restarts.
    <br><br>

    PC: keyboard<br><br>
    Mobile: swipe screen

    <br><br><br>

    <button onclick="startGame()" style="cursor:pointer;border:5px white solid;background:black;color:white;font-size:30px;width:200px;padding:10px 0;">START</button>

</div>


<div id="game" style="display:none;">
    <table style="width:300px;z-index:3;position:fixed;left:50%;margin-left:-130px;top:0;font-size:25px;color:white;top:10px;">
        <tr>
        <td width="33%">
            SCORE<br>
            <span id="total_score">0</span>
        </td>
        <td width="33%">
            BEST<br>
            <span id="best_score">0</span>
        </td>
        <td width="33%">
            NEXT<br>
            <img id="next" style="max-height:15px;">
        </td>
        </tr>
    </table>

    <div id="cover" style="background-position:center center;z-index:1;image-rendering: pixelated;position:fixed;left:0;top:0;width:100%;height:100%;"></div>

    <div id="pos" style="display:none;z-index:999;position:fixed;left:0;top:0;background:red;color:white;padding:20px">0,0</div>


    <div id="current" style="z-index:2;position:fixed;width:150px;height:150px;background:url('static/3.png');background-position:center center;background-size:30% auto;background-repeat:no-repeat;">
    </div>

    <table class="game" style="z-index:999;position:fixed;left:0;top:0;width:100%;height:100%;" border="1">
        <tr>
            <td style="background-repeat:no-repeat;background-position:center center;background-size:130px auto;"></td>
            <td style="background-repeat:no-repeat;background-position:center center;background-size:130px auto;"></td>
        </tr>
        <tr>
            <td style="background-repeat:no-repeat;background-position:center center;background-size:130px auto;"></td>
            <td style="background-repeat:no-repeat;background-position:center center;background-size:130px auto;"></td>
        </tr>
    </table>

</div>


<audio id="music" loop>
    <source src="static/music.mp3" type="audio/mp3">
</audio>

<audio id="sound_fail">
    <source src="static/fail.mp3" type="audio/mp3">
</audio>




<script src="https://code.jquery.com/jquery-3.5.1.min.js"
integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<script src="https://code.jquery.com/mobile/1.5.0-rc1/jquery.mobile-1.5.0-rc1.min.js"></script>


<script src="static/jquerymobile-swipeupdown.js"></script>


<script>
var current_x = 0;
var current_y = 0;
var next_x = 0;
var next_y = 0;
var current_time = 50;
var speed = 5;
var default_speed = 2000 + speed;
var current_speed = default_speed;
var timer;
var max_moves = 2;
var total_moves = 0;
var piece_width = 80;
var best_score = 0;
var total_score = 0;
var music_playing = false;

var cur_x = 0;
var cur_y = 0;
var cur_w = piece_width;
var cur_h = piece_width;

var screen_height = $(document).height();
var screen_width = $(document).width();
var screen_width_half = screen_width / 2;
var screen_height_half = (screen_height / 2);
var current_piece;
var next_piece;

function moveLeft(){
    if( current_x == 0 ) return;
    if( total_moves == max_moves ) return;
    total_moves++;
    if( current_x == 1 ) current_x--;
    updatePos();
}

function moveRight(){
    if( current_x == 1 ) return;
    if( total_moves == max_moves ) return;
    total_moves++;
    if( current_x == 0 ) current_x++;
    updatePos();
}

function moveUp(){
    if( current_y == 0 ) return;
    if( total_moves == max_moves ) return;
    total_moves++;
    if( current_y == 1 ) current_y--;
    updatePos();
}

function moveDown(){
    if( current_y == 1 ) return;
    if( total_moves == max_moves ) return;
    total_moves++;
    if( current_y == 0 ) current_y++;
    updatePos();
}

function randomNumber(min, max) {
    if (min > max) {
        let temp = max;
        max = min;
        min = temp;
    }

    if (min <= 0) {
        return Math.floor(Math.random() * (max + Math.abs(min) + 1)) + min;
    } else {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }
}

$("body").on("swipeleft", function () {
    moveLeft();
});

$("body").on("swiperight", function () {
    moveRight();
});

$("body").on("swipeup", function () {
    moveUp();
});

$("body").on("swipedown", function () {
    moveDown();
});

$("body").keydown(function (e) {


    if (e.keyCode == 38) {
        moveUp();
    } else if (e.keyCode == 40) {
        moveDown();
    } else if (e.keyCode == 37) {
        moveLeft();
    } else if (e.keyCode == 39) {
        moveRight();
    }


});


function arrayRemove(arr, value) { 
    
    return arr.filter(function(ele){ 
        return ele != value; 
    });
}

function shuffle(array) {
  var currentIndex = array.length,  randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;

    // And swap it with the current element.
    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]];
  }

  return array;
}



function randomPos(){

    total_moves = 0;


    if( current_speed < default_speed ){
        if( $('.game tr:eq(' + current_y + ') td:eq(' + current_x + ')').data('value') == current_piece ){
            //$('table').css('border','5px #00ff00 solid');
            $('.game tr:eq(' + current_y + ') td:eq(' + current_x + ')').css('background-color','#00ff00');

            total_score++;

        }else{
            $('.game tr:eq(' + current_y + ') td:eq(' + current_x + ')').css('background-color','red');
            current_speed = default_speed;

            total_score = 0;

            $('#best_score').html(best_score);

            $('#sound_fail')[0].play();
        }


        if( total_score > best_score ){
            best_score = total_score;
        }
        $('#best_score').html(best_score);

        
        $('#total_score').html(total_score);

        setTimeout(function(){
            $('.game td').css('background-color','transparent');
        }, 200);
    }


    current_speed -= speed;

    if( !current_piece ){
        current_piece = randomNumber(1, 5);
    }else{
        current_piece = next_piece;
    }
    
    next_piece = randomNumber(1, 5);


    
    $('#next').attr('src', 'static/' + next_piece + '.png');


    cur_w = piece_width;
    cur_h = piece_width;
    cur_x = (screen_width-piece_width)/2;
    cur_y = (screen_height-piece_width)/2;




    $('#current').css('background-image', "url('static/" + current_piece + ".png')").css('width',cur_w).css('height',cur_h).css('left', cur_x).css('top', cur_y);
    




    var pieces = [1,2,3,4,5];


    var pieces_aux = arrayRemove(pieces, current_piece);


    /*

    var pieces_aux = [];
    

    for(var i=0; i<pieces.length; i++){
        if( pieces[i] != current_piece ){
            pieces_aux.push(pieces[i]);
        }
    }

    shuffle(pieces_aux);

    */


    pieces_aux[0] = current_piece;


    shuffle(pieces_aux);

    for(var i=0; i<4; i++){
        $('.game td:eq(' + i + ')').css('background-image', "url('static/" + pieces_aux[i] + "__.png')").data('value', pieces_aux[i]);
    }


    


    updatePos();

}


function startGame(){
    $('#intro').hide();
    $('#game').show();
    randomPos();
}


function updatePos(){
    $('#pos').html(current_x +', ' + current_y);


    if( current_x == 0 ){
        next_x = 0;
    }else{
        next_x = screen_width_half;
    }

    if( current_y == 0 ){
        next_y = 0;
    }else{
        next_y = screen_height_half;
    }
     

    clearInterval(timer);


    
    /*
    timer = setInterval(function(){
 

        
        if( current_x == 0 ){
            cur_x-=0.5;
        }else{
            cur_x=0.5;
        }

        if( current_y == 0 ){
            cur_y-=0.5;
        }else{
            cur_y+=0.5;
        }

        cur_w++;
        cur_h++;





        $('#current').css('left', cur_x).css('top', cur_y).css('width', cur_w).css('height', cur_h);

        
        //&& cur_w == screen_width_half && cur_h == screen_height_half
        //cur_x <= next_x && cur_y <= next_y

        if( (cur_w-110) >= screen_width_half && (cur_h-110) >= screen_height_half ){
            clearInterval(timer);
            randomPos();
        }

    })
    */



    $('#current').stop().animate({
        width: screen_width_half,
        height: screen_height_half,
        left: next_x,
        top: next_y
    }, current_speed, function(){

        randomPos();
    });



}


$('body').click(function (e) {
    if (!music_playing) {
        music_playing = true;
        $('#music')[0].play();
    }
});

$('#music')[0].volume = 0.5;


</script>
    
</body>
</html>