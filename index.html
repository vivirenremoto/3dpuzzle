<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tetris Hero</title>

    
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

    
    <link rel="prefetch" href="static/music2.mp3" />
    <link rel="prefetch" href="static/music3.mp3" />
    <!--<link rel="prefetch" href="static/fail.mp3" />-->
    <link rel="prefetch" href="static/1a.png" />
    <link rel="prefetch" href="static/2a.png" />
    <link rel="prefetch" href="static/3a.png" />
    <link rel="prefetch" href="static/4a.png" />
    <link rel="prefetch" href="static/5a.png" />
    <link rel="prefetch" href="static/1____.png" />
    <link rel="prefetch" href="static/2____.png" />
    <link rel="prefetch" href="static/3____.png" />
    <link rel="prefetch" href="static/4____.png" />
    <link rel="prefetch" href="static/5____.png" />
    <link rel="prefetch" href="static/1____b.png" />
    <link rel="prefetch" href="static/2____b.png" />
    <link rel="prefetch" href="static/3____b.png" />
    <link rel="prefetch" href="static/4____b.png" />
    <link rel="prefetch" href="static/5____b.png" />
    <link rel="prefetch" href="static/bg_screen3.gif" />

    
    <meta property="og:image" content="https://vivirenremoto.github.io/3dpuzzle/static/social.jpg">
    <meta property="og:image:secure_url" content="https://vivirenremoto.github.io/3dpuzzle/static/social.jpg">
    <meta property="og:image:alt" content="Tetris Hero">
    <meta property="og:image:type" content="image/png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Tetris Hero">
    <meta name="twitter:image" content="https://vivirenremoto.github.io/3dpuzzle/static/social.jpg">

</head>
<body>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-V3X0Y12D65"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-V3X0Y12D65');
</script>


<style>
* {
    font-family: 'VT323', monospace;
    text-transform: uppercase;

    -webkit-touch-callout: none;
    /* iOS Safari */
    -webkit-user-select: none;
    /* Safari */
    -khtml-user-select: none;
    /* Konqueror HTML */
    -moz-user-select: none;
    /* Old versions of Firefox */
    -ms-user-select: none;
    /* Internet Explorer/Edge */
    user-select: none;
    /* Non-prefixed version, currently
                    supported by Chrome, Edge, Opera and Firefox */

    /* evitar elementos seleccionados al clicar */
    -webkit-tap-highlight-color: transparent;
}

body {
    touch-action: pan-x pan-y;
    overflow:hidden;
}

.ui-page{border:0;width:100%;height:100%;min-height:100%;min-width:100%;max-width:100%;max-height:100%;}

body{background:black;height:100%;width:100%;padding:0;margin:0;}
#cover{opacity:0.3;}
.game td{opacity:0.3;background-size:130px auto;border:5px transparent solid;}

.game td img{width:130px;}

#cover{background-size:100% auto;background-image:url("static/bg_screen3.gif");}

#current{background-size:20% auto;}

h1,h2{font-weight:normal;}

#icon_music svg{width:90px;height:90px;opacity:0.8;}

@media screen and (max-width: 480px) {
    #cover{background-size:auto 100%;background-image:url("static/bg_screen3.gif");}
    #author{display:none;}

    
    .game td{background-size:80px auto;}

    
    .game td img{width:80px;}

    #current{background-size:30% auto;}

    .only_desktop{display:none;}

    H1{font-size:40px;}
    h2{font-size:30px;}

    
    #icon_music svg{width:60px;height:60px;}
}
</style>

    
<a id="author" href="https://twitter.com/vivirenremoto" target="_blank"
style="font-size:30px;position:fixed;right:30px;top:10px;z-index:2;color:white;text-decoration:none;">by
@vivirenremoto</a>


<div id="intro" style="left:0;position:fixed;top:0;height:100%;width:100%;color:white;text-align:center;font-size:30px;overflow-y:scroll;">
    <h1 style="color:yellow;">Tetris Hero</h1>

    In each round you have only 2 moves, <br class="only_desktop">score is reset if you make a mistake
    <br><br>

    controls ←→↑↓<br>
    PC: keyboard<br>
    Mobile: swipe

    <br><br>

    <button onclick="startGame()" style="cursor:pointer;border:5px white solid;background:black;color:white;font-size:30px;width:250px;padding:10px 0;">START<span class="only_desktop"> - ENTER</span></button>
    <br><br>

    <button onclick="changeDifficult()" class="btn_difficult" style="cursor:pointer;border:5px white solid;background:black;color:white;font-size:30px;width:250px;padding:10px 0;">MODE: NORMAL</button>

    
    <br><br>

    <button onclick="changeMusic()" class="btn_music" style="cursor:pointer;border:5px white solid;background:black;color:white;font-size:30px;width:250px;padding:10px 0;">MUSIC: TETRIS</button>

    
</div>


<div id="result" style="display:none;color:white;text-align:center;font-size:30px;overflow-y:scroll;left:0;position:fixed;top:0;height:100%;width:100%;">
    
    <h1 style="color:yellow;">Game over</h1>
    <h2 style="margin-bottom:0;margin-top:5px;">SCORE: <span class="total_score2"></span></h2>

    



    <br>

    <button onclick="startGame()" style="cursor:pointer;border:5px white solid;background:black;color:white;font-size:30px;width:250px;padding:10px 0;">TRY AGAIN<span class="only_desktop"> - ENTER</span></button>

    <br><br>

    <button onclick="changeDifficult()" class="btn_difficult" style="cursor:pointer;border:5px white solid;background:black;color:white;font-size:30px;width:250px;padding:10px 0;">MODE: NORMAL</button>


    <br><br>

    <button onclick="changeMusic()" class="btn_music" style="cursor:pointer;border:5px white solid;background:black;color:white;font-size:30px;width:250px;padding:10px 0;">MUSIC: TETRIS</button>

    <br><br>

    <button onclick="showIntro()()" style="cursor:pointer;border:5px white solid;background:black;color:white;font-size:30px;width:250px;padding:10px 0;">HOW TO PLAY</button>

    <br><br>
    <button onclick="share()" style="cursor:pointer;border:5px white solid;background:black;color:white;font-size:30px;width:250px;padding:10px 0;">SHARE</button>

</div>


<div id="game" style="display:none;">
    <table style="width:300px;z-index:3;position:fixed;left:50%;margin-left:-130px;top:0;font-size:25px;color:white;top:10px;">
        <tr>
        <td width="33%">
            SCORE<br>
            <span class="total_score">0</span>
        </td>
        <td width="33%">
            BEST<br>
            <span class="best_score">0</span>
        </td>
        <td width="33%">
            NEXT<br>
            <img id="next" style="max-height:15px;">
        </td>
        </tr>
    </table>
    <div id="icon_music" style="z-index:99999;position:fixed;right:5px;bottom:5px;cursor:pointer;" onclick="changeMusic()">
        <svg style="color:white;" xmlns="http://www.w3.org/2000/svg" width="100" height="100" fill="currentColor" class="bi bi-music-note-beamed" viewBox="0 0 16 16">
            <path d="M6 13c0 1.105-1.12 2-2.5 2S1 14.105 1 13c0-1.104 1.12-2 2.5-2s2.5.896 2.5 2zm9-2c0 1.105-1.12 2-2.5 2s-2.5-.895-2.5-2 1.12-2 2.5-2 2.5.895 2.5 2z"/>
            <path fill-rule="evenodd" d="M14 11V2h1v9h-1zM6 3v10H5V3h1z"/>
            <path d="M5 2.905a1 1 0 0 1 .9-.995l8-.8a1 1 0 0 1 1.1.995V3L5 4V2.905z"/>
          </svg>
    </div>

    <div id="moves" style="display:none;left:50%;top:50%;font-size:200px;text-align:center;width:100px;margin-left:-50px;margin-top:-100px;position:fixed;color:#00ff00;opacity:0.5;">3</div>

    <div id="cover" style="background-position:center center;z-index:1;image-rendering: pixelated;position:fixed;left:0;top:0;width:100%;height:100%;"></div>

    <div id="pos" style="display:none;z-index:999;position:fixed;left:0;top:0;background:red;color:white;padding:20px">0,0</div>


    <div id="current" style="display:none;z-index:2;position:fixed;width:150px;height:150px;background-position:center center;background-repeat:no-repeat;">
    </div>

    <table class="game" style="text-align:center;z-index:999;position:fixed;left:0;top:0;width:100%;height:100%;" border="1">
        <tr>
            <td style="background-repeat:no-repeat;background-position:center center;border:5px yellow solid;"><img src="static/1____.png"></td>
            <td style="background-repeat:no-repeat;background-position:center center;"><img src="static/1____.png" ></td>
        </tr>
        <tr>
            <td style="background-repeat:no-repeat;background-position:center center;"><img src="static/1____.png" ></td>
            <td style="background-repeat:no-repeat;background-position:center center;"><img src="static/1____.png" ></td>
        </tr>
    </table>

</div>


<audio id="music" loop>
    <source src="static/music2.mp3" type="audio/mp3">
</audio>

<audio id="music2" loop>
    <source src="static/music3.mp3" type="audio/mp3">
</audio>

<!--
<audio id="sound_fail">
    <source src="static/fail.mp3" type="audio/mp3">
</audio>
-->



<script src="https://code.jquery.com/jquery-3.5.1.min.js"
integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<script src="https://code.jquery.com/mobile/1.5.0-rc1/jquery.mobile-1.5.0-rc1.min.js"></script>


<script src="static/jquerymobile-swipeupdown.js"></script>


<script>
var difficult = 1;
var first_try = false; 
var current_x = 0;
var current_y = 0;
var next_x = 0;
var next_y = 0;
var current_time = 50;
var speed_normal = 30;
var speed_easy = 15;
var speed = speed_normal;
var speed_max = 700;
var default_speed = 2000 + speed;
var current_speed = default_speed;
var timer;
var default_moves = 2;
var max_moves = default_moves;
var total_moves = 0;
var piece_width = 80;
var best_score = 0;
var total_score = 0;
var min_score = 0;
var failed_score = 0;

var cur_x = 0;
var cur_y = 0;
var cur_w = piece_width;
var cur_h = piece_width;

var screen_height = $(document).height();
var screen_width = $(document).width();
var screen_width_half = screen_width / 2;
var screen_height_half = (screen_height / 2);
var current_piece;
var next_piece;
var game_start = false;
var music = 1;

function moveLeft(){
    if( !game_start ) return;
    speed_diff = speed_max;
    if( current_x == 0 ) return;
    if( total_moves >= max_moves ) return;
    total_moves++;
    if( current_x == 1 ) current_x--;
    updatePos();
}

function moveRight(){
    if( !game_start ) return;
    speed_diff = speed_max;
    if( current_x == 1 ) return;
    if( total_moves >= max_moves ) return;
    total_moves++;
    if( current_x == 0 ) current_x++;
    updatePos();
}

function moveUp(){
    if( !game_start ) return;
    speed_diff = speed_max;
    if( current_y == 0 ) return;
    if( total_moves >= max_moves ) return;
    total_moves++;
    if( current_y == 1 ) current_y--;
    updatePos();
}

function moveDown(){
    if( !game_start ) return;
    speed_diff = speed_max;
    if( current_y == 1 ) return;
    if( total_moves >= max_moves ) return;
    total_moves++;
    if( current_y == 0 ) current_y++;
    updatePos();
}

function randomNumber(min, max) {
    if (min > max) {
        let temp = max;
        max = min;
        min = temp;
    }

    if (min <= 0) {
        return Math.floor(Math.random() * (max + Math.abs(min) + 1)) + min;
    } else {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }
}

$("body").on("swipeleft", function () {
    moveLeft();
});

$("body").on("swiperight", function () {
    moveRight();
});

$("body").on("swipeup", function () {
    moveUp();
});

$("body").on("swipedown", function () {
    moveDown();
});

$("body").keydown(function (e) {


    if (e.keyCode == 38) {
        moveUp();
    } else if (e.keyCode == 40) {
        moveDown();
    } else if (e.keyCode == 37) {
        moveLeft();
    } else if (e.keyCode == 39) {
        moveRight();
    } else if (e.keyCode == 13 &&  $('#game:visible').length == 0 ) {
        startGame();
    }


});


function arrayRemove(arr, value) { 
    
    return arr.filter(function(ele){ 
        return ele != value; 
    });
}

function shuffle(array) {
  var currentIndex = array.length,  randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;

    // And swap it with the current element.
    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]];
  }

  return array;
}



function endGame(){
    $('#result .total_score2').html(failed_score);
    $('#game').hide();
    $('#result').show();
    clearInterval(timer);
}

function randomPos(){

    speed_diff = 0;

    total_moves = 0;


    // normal, hard
    if( difficult > 0 ){
        if( total_score == 20 ){
            current_speed += 300;
        }

        if( total_score == 30 ){
            
            // normal
            if( difficult == 1 ) max_moves = 3;

            $('#moves').html(max_moves);
            current_speed += 300;
        }
    }



    if( game_start ){
        failed_score = 0;


        if( $('.game tr:eq(' + current_y + ') td:eq(' + current_x + ') img').data('value') == current_piece ){
            //$('table').css('border','5px #00ff00 solid');
            $('.game tr:eq(' + current_y + ') td:eq(' + current_x + ')').css('background-color','#00ff00');

            total_score++;

        }else{
            $('.game tr:eq(' + current_y + ') td:eq(' + current_x + ')').css('background-color','red');

            current_speed = default_speed;



            if( difficult == 0 ){
                speed = speed_easy;
            }else{
                speed = speed_normal;
            }


            failed_score = total_score;
            total_score = 0;



            if( music == 1 ){
                $('#music')[0].currentTime = 0;
                //$('#music')[0].pause();
            }

            //$('#sound_fail')[0].play();

        }


        if( total_score > best_score ){
            best_score = total_score;
        }
        $('.best_score').html(best_score);

        
        $('.total_score').html(total_score);

        setTimeout(function(){
            $('.game td').css('background-color','transparent');
        }, 150);



        if( failed_score > min_score ){
            min_score = failed_score;


            if( music == 1 ){
                $('#music')[0].pause();
            }



            setTimeout(function(){
                endGame();
            }, 300);
            return;
        }   



    }


    current_speed -= speed;

    console.log(current_speed);

    if( !current_piece ){
        current_piece = randomNumber(1, 5);
    }else{
        current_piece = next_piece;
    }
    
    next_piece = randomNumber(1, 5);


    
    $('#next').attr('src', 'static/' + next_piece + '____b.png');


    cur_w = piece_width;
    cur_h = piece_width;
    cur_x = (screen_width-piece_width)/2;
    cur_y = (screen_height-piece_width)/2;




    $('#current').css('background-image', "url('static/" + current_piece + "a.png')").css('width',cur_w).css('height',cur_h).css('left', cur_x).css('top', cur_y);
    




    var pieces = [1,2,3,4,5];


    var pieces_aux = arrayRemove(pieces, current_piece);




    pieces_aux[0] = current_piece;


    shuffle(pieces_aux);
    shuffle(pieces_aux);

    if( total_score == 0 ){
        $('.game td img').css('transform', 'rotate(0deg)');
    }

    var diff_piece = 'b';



    if( difficult > 0 ){ // at least easy

        

        if( total_score > 10 ){
            diff_piece = '';
        
        }
        

        if( difficult == 1 ){ // normal

            if( total_score > 20 ){




                if( total_score > 30 ){
                    var rand_deg = randomNumber(0, 360);

                    $('.game td img').css('transform', 'rotate(' + rand_deg + 'deg)');
                
                }else{

                    var rand_deg = randomNumber(0, 360) * 90;

                    $('.game td img').css('transform', 'rotate(' + rand_deg + 'deg)');
                }

            }

        }else{ // hard
            var rand_deg = randomNumber(0, 360);

            $('.game td img').css('transform', 'rotate(' + rand_deg + 'deg)');
        }

    }

    

    for(var i=0; i<4; i++){
        $('.game td:eq(' + i + ') img').attr('src', "static/" + pieces_aux[i] + "____" + diff_piece + ".png").data('value', pieces_aux[i]);
    }


    


    updatePos();

}


function showIntro(){
    $('#result').hide();
    $('#intro').show();
}


function startGame(){

    max_moves = default_moves;

    if( difficult == 0 ){
        speed = speed_easy;
    }else{
        speed = speed_normal;
    }

    

    if( music == 1 ){
        $('#music')[0].play();
    }else{
        $('#music2')[0].play();
    }


    
    $('#intro').hide();
    $('#result').hide();
    $('#game').show();


    randomPos();
    
}


function updatePos(){
    $('#pos').html(current_x +', ' + current_y+'---'+speed);
    


    if( current_x == 0 ){
        next_x = 0;
    }else{
        next_x = screen_width_half;
    }

    if( current_y == 0 ){
        next_y = 0;
    }else{
        next_y = screen_height_half;
    }


    $('.game td').css('border','5px transparent solid');
    $('.game tr:eq(' + current_y + ') td:eq(' + current_x + ')').css('border','5px yellow solid');


    clearInterval(timer);


    


    
    if( speed_diff < current_speed ){
        speed_aux = current_speed-speed_diff;
    }else{
        speed_aux = current_speed;
    }

    
    if( !first_try ){
        first_try = true;


        var bg_aux = $('#next').attr('src');
            $('#next').attr('src', 'static/' + current_piece + '____b.png');

        

        setTimeout(function(){


            $('#moves').show().html('3').css('color','white');
            setTimeout(function(){
                $('#moves').html('2');
                setTimeout(function(){
                    $('#moves').html('1');

                    setTimeout(function(){
                        $('#moves').html('<span style="position:relative;margin-left:-30px">GO</span>');

                        $('#next').attr('src',bg_aux);

                        game_start = true;

                        setTimeout(function(){

                            $('#current').show();


                            $('#moves').html('').css('color','#00ff00');
                            
                            startPlaying();

                        }, 1000);



                    }, 1000);
                }, 1000);
            }, 1000);
        }, 1000);



    }else{





        
        startPlaying();

    }





}


function startPlaying(){
    





    
    var diff_moves = max_moves - total_moves;

    $('#moves').html(diff_moves);

    if( diff_moves == 0 ){
        $('#moves').css('color','red');
    }else{
        $('#moves').css('color','#00ff00');

    }

    


    $('#current').stop().animate({
        width: screen_width_half,
        height: screen_height_half,
        left: next_x,
        top: next_y,
    }, speed_aux, function(){

        randomPos();
    });
}

function changeMusic(){
    var song = 'Tetris';
    if( music == 1 ){
        song = 'Future';
        music = 2;
        $('#music')[0].pause();
        $('#music2')[0].currentTime = 0;
        $('#music2')[0].play();
    }else{
        music = 1;
        $('#music')[0].currentTime = 0;
        $('#music')[0].play();
        $('#music2')[0].pause();
    }
    $('.btn_music').html('Music: ' + song);
}

function changeDifficult(){
    var mode = 'Normal';
    if( difficult == 1 ){
        mode = 'easy';
        difficult = 0;
    }else if( difficult == 0 ){
        mode = 'hard';
        difficult = 2;
    }else{
        mode = 'normal';
        difficult = 1;
    }

    $('.btn_difficult').html('Mode: ' + mode);
}

function share() {


    var share_title = document.title;
    var share_url = document.location.href;

    if (total_score) {
        share_title += ' 👊 Beat my score! 🔥' + total_score;
    }

    if (navigator.share) {
        navigator.share({
            title: share_title,
            url: share_url
        });

    } else {
        window.open('https://twitter.com/intent/tweet?text=' + encodeURIComponent(share_title) + '&tw_p=tweetbutton&url=' + encodeURIComponent(share_url));
    }

}




$('#music')[0].volume = 0.5;
$('#music2')[0].volume = 0.5;

</script>
    
</body>
</html>
